# ‚öôÔ∏è –Ø–¥—Ä–æ —Å–∏–º—É–ª—è—Ü–∏–∏ (simulation/core/)

–ü–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏.  

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
core/
‚îú‚îÄ‚îÄ traffic_generator.py # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ –∑–∞—è–≤–æ–∫
‚îî‚îÄ‚îÄ processor.py # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
```

## üìÑ –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### `traffic_generator.py` - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—Ä–∞—Ñ–∏–∫–∞

–°–æ–∑–¥–∞–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–æ–º–∏–Ω—É—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ 24 —á–∞—Å–∞ –≤–ø–µ—Ä–µ–¥.  

**–ö–ª–∞—Å—Å `TrafficGenerator`:**
```
python
''' –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è '''
gen = TrafficGenerator(total_applications=101503)
minute_counts = gen.generate_minute_counts(start_hour=17, start_minute=30)
```
#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
- –£—Ç—Ä–µ–Ω–Ω–µ-–¥–Ω–µ–≤–Ω–æ–π –ø–∏–∫ (13:00) - –æ—Å–Ω–æ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  
- –í–µ—á–µ—Ä–Ω–∏–π –ø–∏–∫ (19:30) - –≤—Ç–æ—Ä–∞—è –≤–æ–ª–Ω–∞   
- –ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω—ã–π —Å–ø–∞–¥ (15:30) - –∑–∞—Ç–∏—à—å–µ  
- –§–æ–Ω–æ–≤—ã–π —à—É–º - —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è  
  
#### –ò–º–ø—É–ª—å—Å—ã (—Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏):
```
python
''' –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è '''
impulses = [{'time': (5, 30), 'strength': 2.0}]  # –≤ 5:30 –Ω–∞–ø–ª—ã–≤ –≤ 2 —Ä–∞–∑–∞
minute_counts = gen.generate_minute_counts(impulses=impulses)
```
#### –ú–µ—Ç–æ–¥—ã:
`generate_minute_counts()` - –º–∞—Å—Å–∏–≤ –Ω–∞ 1440 –º–∏–Ω—É—Ç  
`generate_hourly_counts()` - –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ —á–∞—Å–∞–º  
`plot_distribution()` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è  

### `processor.py` - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—á–µ—Ä–µ–¥–µ–π

–ú–æ–¥–µ–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞—è–≤–æ–∫.  

**–ö–ª–∞—Å—Å `ApplicationProcessor`:**  

#### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:  
```
python
processor = ApplicationProcessor(
    lr_model,                 # Logistic Regression
    second_model,              # XGBoost/LightGBM/etc
    second_model_name,         # –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏
    specialists_count=5,       # –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
    business_specialists_count=2,  # —ç–∫—Å–ø–µ—Ä—Ç—ã (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞)
    base_processing_time=5,    # –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ (–º–∏–Ω)
    business_processing_time=10 # –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏ (–º–∏–Ω)
)
```

#### –î–≤–∞ —Ç–∏–ø–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:
specialists - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É–ª (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞—è–≤–∫–∏ –æ—Ç –º–æ–¥–µ–ª–µ–π)  
business_specialists - —ç–∫—Å–ø–µ—Ä—Ç—ã (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞—è–≤–∫–∏ –æ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª)  

**–î–≤–µ –æ—á–µ—Ä–µ–¥–∏:**

`manual_queue` - –∑–∞—è–≤–∫–∏, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –º–æ–¥–µ–ª—è–º–∏  
`business_queue` - –∑–∞—è–≤–∫–∏, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏  

#### –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥:
```
python
def process_batch(self, applications_batch, preprocessor, scaler,
                  threshold, lr_margins, second_margins, current_time):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞—Ç—á –∑–∞—è–≤–æ–∫ –∑–∞ —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –£–º–µ–Ω—å—à–∞–µ—Ç –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞–Ω—è—Ç—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (-1 –º–∏–Ω—É—Ç–∞)
    2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∫–æ –≤—Å–µ–º –∑–∞—è–≤–∫–∞–º (check_business_rules)
    3. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª:
       - –ö–æ–¥—ã 96/98 –∏ –¥—Ä. ‚Üí –≤ –±–∏–∑–Ω–µ—Å-–æ—á–µ—Ä–µ–¥—å
       - –í–æ–∑—Ä–∞—Å—Ç < 18 ‚Üí –∞–≤—Ç–æ-–æ—Ç–∫–∞–∑
       - –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –∏–¥—É—Ç –≤ –º–æ–¥–µ–ª–∏
    4. –ë–∞—Ç—á–µ–≤–æ –≤—ã–∑—ã–≤–∞–µ—Ç escalation_decision –¥–ª—è –∑–∞—è–≤–æ–∫, –ø—Ä–æ—à–µ–¥—à–∏—Ö –ø—Ä–∞–≤–∏–ª–∞
    5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ–ª–µ–π:
       - –£–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è ‚Üí —Å—Ä–∞–∑—É –æ–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–∞–∑
       - –ù–µ—É–≤–µ—Ä–µ–Ω–Ω—ã–µ ‚Üí –≤ –æ—Å–Ω–æ–≤–Ω—É—é –æ—á–µ—Ä–µ–¥—å
    6. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –Ω–∞ –∑–∞—è–≤–∫–∏ –∏–∑ –±–∏–∑–Ω–µ—Å-–æ—á–µ—Ä–µ–¥–∏
    7. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –Ω–∞ –∑–∞—è–≤–∫–∏ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
    """
```
#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

1. –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏:  
```
python
def processing_time_function(lr_proba, second_proba, threshold=0.5, base_time=5):
    # –ß–µ–º –±–ª–∏–∂–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫ –ø–æ—Ä–æ–≥—É, —Ç–µ–º –¥–æ–ª—å—à–µ —Ä–∞–∑–±–æ—Ä
    margin = abs(proba - threshold)
    max_margin = max(threshold, 1 - threshold)
    uncertainty = 1 - (margin / max_margin)
    mean_time = base_time * (1 + 3 * uncertainty)
    return np.random.exponential(scale=mean_time)
```

2. –î–≤–∞ —Ç–∏–ø–∞ —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞:  
- –û—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª ‚Üí —ç–∫—Å–ø–µ—Ä—Ç—ã, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (`business_processing_time`)  
- –û—Ç –º–æ–¥–µ–ª–µ–π ‚Üí —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã, –≤—Ä–µ–º—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏  
  
3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`self.stats`):  
- –†–∞–∑–º–µ—Ä—ã –æ—á–µ—Ä–µ–¥–µ–π –Ω–∞ –∫–∞–∂–¥–æ–π –º–∏–Ω—É—Ç–µ   
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ (–æ–¥–æ–±—Ä–µ–Ω–æ/–æ—Ç–∫–∞–∑–∞–Ω–æ)   
- –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—è—Ö   
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤   
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º (—Å–∫–æ–ª—å–∫–æ –≤ —Ä—É—á–Ω–æ–π, —Å–∫–æ–ª—å–∫–æ –∞–≤—Ç–æ-–æ—Ç–∫–∞–∑)    
4. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞—Ç—á–∞–º (self.batch_stats):    
–î–ª—è –∫–∞–∂–¥–æ–π –º–∏–Ω—É—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:  
- –°–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ —É—à–ª–æ –≤ —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –æ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª  
- –°–∫–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏–ª–∏ –∞–≤—Ç–æ-–æ—Ç–∫–∞–∑ –æ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª  
- –°–∫–æ–ª—å–∫–æ —É–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–∞–ª–∞ `LR`  
- –°–∫–æ–ª—å–∫–æ —É–≤–µ—Ä–µ–Ω–Ω—ã—Ö/–Ω–µ—É–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–∞–ª–∞ –≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å  
  
**–°–≤—è–∑—å —Å —ç—Å–∫–∞–ª–∞—Ü–∏–µ–π:**

`processor.py` –≤—ã–∑—ã–≤–∞–µ—Ç `escalation_decision()` –∏–∑ `models/escalation.py` –¥–ª—è –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫:  
```
python
batch_decisions, batch_manual_mask, stats = escalation_decision(
    model_df,                 # –∑–∞—è–≤–∫–∏, –ø—Ä–æ—à–µ–¥—à–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
    self.lr_model,
    self.second_model,
    self.second_model_name,
    threshold=threshold,
    lr_margins=lr_margins,
    second_margins=second_margins,
    preprocessor=preprocessor,
    scaler=scaler
)
```

#### üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞ –º–∏–Ω—É—Ç—É
```
1. –ü–æ–ª—É—á–∞–µ–º –±–∞—Ç—á –∑–∞—è–≤–æ–∫ (`traffic_generator`)
2. –£–º–µ–Ω—å—à–∞–µ–º —Ç–∞–π–º–µ—Ä—ã –∑–∞–Ω—è—Ç—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
3. –ü—Ä–∏–º–µ–Ω—è–µ–º –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∫–æ –≤—Å–µ–º –∑–∞—è–≤–∫–∞–º
   ‚îú‚îÄ‚îÄ –ö–æ–¥—ã 96/98 –∏ –¥—Ä. ‚Üí –≤ `business_queue`
   ‚îú‚îÄ‚îÄ –í–æ–∑—Ä–∞—Å—Ç < 18 ‚Üí –∞–≤—Ç–æ-–æ—Ç–∫–∞–∑
   ‚îî‚îÄ‚îÄ –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –≤ `escalation_decision`
        ‚îú‚îÄ‚îÄ `LR` —É–≤–µ—Ä–µ–Ω–∞ ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
        ‚îú‚îÄ‚îÄ `LR` –Ω–µ —É–≤–µ—Ä–µ–Ω–∞ ‚Üí –≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å
        ‚îÇ    ‚îú‚îÄ‚îÄ —É–≤–µ—Ä–µ–Ω–∞ ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
        ‚îÇ    ‚îî‚îÄ‚îÄ –Ω–µ —É–≤–µ—Ä–µ–Ω–∞ ‚Üí –≤ `manual_queue`
        ‚îî‚îÄ‚îÄ ...
4. –ù–∞–∑–Ω–∞—á–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –Ω–∞ `business_queue` 
5. –ù–∞–∑–Ω–∞—á–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –Ω–∞ `manual_queue`  
6. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É  
```
#### üìä –°–æ–±–∏—Ä–∞–µ–º–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

`queue_history` - –¥–∏–Ω–∞–º–∏–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏  
`business_queue_history` - –¥–∏–Ω–∞–º–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª  
`specialist_busy` - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤  
`business_specialist_busy` - –∑–∞–≥—Ä—É–∑–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤  
`wait_times` - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏  
`business_wait_times` - –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª  

#### üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤

`pages/simulation.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–∏  
`simulation/visualization/` - –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏  

üìö –ü–æ–¥—Ä–æ–±–Ω–µ–µ
[–ú–æ–¥–µ–ª—å —ç—Å–∫–∞–ª–∞—Ü–∏–∏](../../models/README.md)  
[PID-—Ä–µ–≥—É–ª—è—Ç–æ—Ä](../controllers/README.md)  
[–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è](../visualization/README.md)  
